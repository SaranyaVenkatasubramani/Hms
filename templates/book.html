{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Doctor Appointment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet" />

  <style>
    body {
      background: url("{% static 'images/bg.jpg' %}") no-repeat center center fixed;
      background-size: cover;
      font-family: 'Poppins', sans-serif;
    }

    .doctor-card {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      max-width: 700px;
      margin: 40px auto;
      padding: 25px;
    }

    .doctor-header {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .doctor-header img {
      width: 90px;
      border-radius: 10px;
    }

    .tabs {
      margin-top: 20px;
    }

    .tab-content {
      margin-top: 20px;
    }

    .form-control,
    .btn {
      border-radius: 10px;
    }

    .btn-primary {
      background-color: #0d6efd;
      border: none;
    }

    .btn-outline-primary {
      border-color: #0d6efd;
      color: #0d6efd;
    }
  </style>
</head>
<body>
  <form method="POST" action="{% url 'book' %}">
    {% csrf_token %}
    <div class="doctor-card">
      <!-- Doctor Info -->
      <div class="doctor-header">
        <img src="{% static 'images/Zara.png' %}" alt="Doctor Image" />
        <div>
          <h4>Dr. Zara Nguyen</h4>
          <p class="text-muted mb-1">Gynaecologist (5 years Exp)</p>
          <p class="text-muted mb-0">Southern California Hospital</p>
          <small class="text-warning">‚≠ê 5.0 (500+ Ratings)</small>
        </div>
      </div>

      <!-- Tabs -->
      <ul class="nav nav-tabs tabs" id="consultTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button
            class="nav-link active"
            id="video-tab"
            data-bs-toggle="tab"
            data-bs-target="#video"
            type="button"
            role="tab"
          >
            Video Consultation
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button
            class="nav-link"
            id="clinic-tab"
            data-bs-toggle="tab"
            data-bs-target="#clinic"
            type="button"
            role="tab"
          >
            Clinic Appointment
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content" id="consultTabContent">
        <!-- Video -->
        <div class="tab-pane fade show active" id="video" role="tabpanel">
          <div class="fee-box p-3 mb-3 bg-light">
            <input type="hidden" name="consultation_type" value="Video" id="consultationType" />
            <input type="hidden" name="doctor_name" value="Dr. Zara Nguyen" />
            <p class="mb-1"><strong>Fee:</strong> $50</p>
            <div class="mb-2">
              <label>Date</label>
              <!-- removed name attribute so this won't be submitted -->
              <input
                type="text"
                class="form-control date-picker"
                id="videoDate"
                placeholder="Select Date"
              />
            </div>
            <div>
              <label>Time</label>
              <select class="form-select" id="videoTime">
                <option value="09:30">9:30 AM</option>
                <option value="09:45">9:45 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="10:15">10:15 AM</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Clinic -->
        <div class="tab-pane fade" id="clinic" role="tabpanel">
          <div class="fee-box p-3 mb-3 bg-light">
            <p class="mb-1"><strong>Fee:</strong> $70</p>
            <p><strong>Location:</strong> 3828 Delmas Terrace, Culver City</p>
            <div class="mb-2">
              <label>Date</label>
              <!-- removed name attribute so this won't be submitted -->
              <input
                type="text"
                class="form-control date-picker"
                id="clinicDate"
                placeholder="Select Date"
              />
            </div>
            <div>
              <label>Time</label>
              <select class="form-select" id="clinicTime">
                <option value="09:30">9:30 AM</option>
                <option value="09:45">9:45 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="10:15">10:15 AM</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Hidden inputs that will actually submit the chosen date and time -->
      <input type="hidden" name="date" id="finalDate" />
      <input type="hidden" name="scheduled_time" id="finalTime" />


      <!-- Buttons -->
      <div class="btn-group w-100 mt-3">
        <button type="submit" class="btn btn-primary w-50">Book Appointment</button>
      </div>
    </div>
  </form>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    flatpickr("#videoDate, #clinicDate", {
      minDate: "today",
      dateFormat: "Y-m-d",
    });

    // Switch consultation type hidden input on tab click
    document.getElementById("video-tab").addEventListener("click", () => {
      document.getElementById("consultationType").value = "Video";
    });
    document.getElementById("clinic-tab").addEventListener("click", () => {
      document.getElementById("consultationType").value = "Clinic";
    });

    // On submit, copy date and time from the active tab inputs into hidden inputs
    document.querySelector("form").addEventListener("submit", (e) => {
      // Find active tab pane
      const activePane = document.querySelector(".tab-pane.active");

      let dateInput, timeInput;

      if (activePane.id === "video") {
        dateInput = document.getElementById("videoDate");
        timeInput = document.getElementById("videoTime");
      } else if (activePane.id === "clinic") {
        dateInput = document.getElementById("clinicDate");
        timeInput = document.getElementById("clinicTime");
      }

      const selectedDate = dateInput.value;
      const selectedTime = timeInput.value;

      if (!selectedDate || !selectedTime) {
        e.preventDefault();
        alert("Please select both date and time before booking.");
        return;
      }

      document.getElementById("finalDate").value = selectedDate;
      document.getElementById("finalTime").value = selectedTime;
    });
  </script>
</body>
</html>

